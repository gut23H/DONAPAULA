
<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Feir√£o de Trufas DonaPaula</title>
  <meta name="description" content="Feir√£o de Trufas DonaPaula - encomende trufas pelo WhatsApp" />
  <style>
    :root{
      --brown:#6b3f2f;
      --pink:#f3c6d1;
      --white:#ffffff;
      --muted:#f7f3f2;
      --rounded:12px;
      --gap:12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:var(--muted); color:#333}
    a{color:inherit}
    header.topo{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,var(--white),#fff8f6);padding:10px 14px;border-bottom:1px solid #eee;display:flex;align-items:center;gap:10px}
    header .brand{display:flex;flex-direction:column}
    header h1{font-size:16px;margin:0;color:var(--brown)}
    header small{font-size:12px;color:#666}
    .container{padding:14px;max-width:520px;margin:0 auto}
    .slider{width:100%;border-radius:12px;overflow:hidden;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,0.06);margin-bottom:14px}
    .slides{display:flex;transition:transform .5s ease}
    .slide{min-width:100%;display:flex;align-items:center;justify-content:center;height:200px;background:#eee}
    .slide img{width:100%;height:100%;object-fit:cover}
    .slider-controls{display:flex;justify-content:center;gap:8px;padding:8px 0;background:#fff}
    .dot{width:10px;height:10px;border-radius:50%;background:#ddd}
    .dot.active{background:var(--brown)}
    .produtos{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
    .card{background:#fff;padding:10px;border-radius:12px;box-shadow:0 6px 14px rgba(0,0,0,0.04)}
    .card img{width:100%;height:110px;object-fit:cover;border-radius:8px;margin-bottom:8px}
    .card h3{margin:0;font-size:14px;color:var(--brown)}
    .card p{margin:6px 0 8px;font-size:12px;color:#666}
    .price{font-weight:700;color:#222}
    .row{display:flex;gap:8px;align-items:center}
    .qty{width:60px;padding:6px;border-radius:8px;border:1px solid #eee}
    .btn{flex:1;padding:8px;border-radius:10px;background:var(--pink);border:0;color:var(--brown);font-weight:700}
    .cart-container{position:fixed;right:12px;bottom:12px;z-index:60}
    .cart-btn{background:var(--brown);color:var(--white);padding:12px 14px;border-radius:999px;border:0;font-weight:700;box-shadow:0 8px 20px rgba(0,0,0,0.2);display:flex;align-items:center;gap:8px}
    .cart-badge{position:absolute;top:-6px;right:-6px;background:#e02424;color:#fff;font-size:12px;padding:4px 7px;border-radius:999px;font-weight:800;display:none}
    .panel{background:#fff;padding:12px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,0.08);margin-bottom:14px}
    .cart-list{display:flex;flex-direction:column;gap:8px}
    .cart-item{display:flex;gap:8px;align-items:center}
    .cart-item img{width:56px;height:56px;object-fit:cover;border-radius:8px}
    .muted{color:#777;font-size:13px}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:80px;background:#111;color:#fff;padding:10px 14px;border-radius:8px;box-shadow:0 8px 20px rgba(0,0,0,0.2);display:none;z-index:80}
    form .input{width:100%;padding:10px;border-radius:10px;border:1px solid #eee;margin-bottom:8px}
    .actions{display:flex;gap:8px}
    .btn-primary{background:var(--brown);color:var(--white);padding:10px;border-radius:10px;border:0;flex:1}
    footer{padding:30px 14px 100px;text-align:center;color:#666;font-size:13px}
    @media(min-width:700px){ .container{max-width:700px} .produtos{grid-template-columns:repeat(3,1fr)} .cart-container{right:24px;bottom:24px} }

    .search-bar {display: flex;gap: 8px;margin-bottom: 14px;background: #fff;padding: 6px 10px;border-radius: 12px;box-shadow: 0 6px 14px rgba(0,0,0,0.06);align-items: center;}
    .search-bar input {flex: 1;padding: 10px;border-radius: 10px;border: 1px solid #eee;outline: none;font-size: 14px;}
    .search-bar input:focus {border-color: var(--brown);}
    .search-bar button {background: var(--brown);color: #fff;border: none;padding: 10px 14px;border-radius: 10px;cursor: pointer;font-size: 16px;font-weight: 700;transition: background 0.2s ease;}
    .search-bar button:hover {background: #59322a;}
    .boton-trufa {display: inline-block;padding: 14px 22px;background: linear-gradient(45deg, #ff4fa3, #ff78bd);color: #fff;font-weight: bold;font-family: Arial;text-decoration: none;border-radius: 12px;position: relative;overflow: hidden;box-shadow: 0 4px 12px rgba(255, 79, 163, 0.4);transition: transform 0.2s ease;}
    .boton-trufa:hover {transform: scale(1.05);}
    .boton-trufa::before {content: "";position: absolute;top: 0;left: -100%;width: 100%;height: 100%;background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.6), transparent);transform: skewX(-25deg);animation: brilho 2s infinite;}
    @keyframes brilho {0%   { left: -100%; }100% { left: 150%; }}
    .muted {font-weight: 600;color: #e91e63;background: #ffe4ec;padding: 3px 6px;border-radius: 5px;display: inline-block;font-size: 10px;}
    .topo-info {margin-top: 4px;background: #ffe4ec;color: #6b3f2f;padding: 6px 10px;border-radius: 8px;font-size: 12px;font-weight: 700;display: inline-block;}
  </style>
</head>
<body>
 <header class="topo">
  <div class="brand">
    <h1>Feir√£o de Trufas DonaPaula</h1>
    <small>Rua Senador Catunda, Centro ‚Äî Guaraciaba do Norte/CE ‚Äî CEP 62380-000</small>
    <span class="topo-info">üéâ Encomendas para festas, eventos e com√©rcio - TRUFAS MEDIDAS GRANDE - </span>
  </div>
</header>

<div class="search-bar">
  <input type="text" id="search" placeholder="Pesquisar trufas..." />
  <button id="btn-search">üîç</button>
</div>

<main class="container">
  <section class="slider" aria-label="Slider de trufas">
    <div class="slides" id="slides">
      <div class="slide"><img src="banner4.png" alt="Trufa 1"/></div>
      <div class="slide"><img src="banner5.png" alt="Trufa 2"/></div>
      <div class="slide"><img src="banner6.png" alt="Trufa 3"/></div>
    </div>
    <div class="slider-controls" id="dots"></div>
  </section>

  <section class="produtos" id="produtos"></section>

  <div style="text-align:center;">
    <button class="boton-trufa" onclick="window.location.href='divulgacao.html'">
      üç´ Materiais de Divulga√ß√£o
    </button>
  </div>

  <section class="panel" id="panel-cart">
    <h2 style="margin-top:0">Seu Pedido</h2>
    <div class="cart-list" id="cart-list"></div>
    <div style="display:flex;justify-content:space-between;margin-top:8px;align-items:center">
      <small class="muted">Subtotal:</small>
      <strong id="subtotal">R$ 0,00</strong>
    </div>
    <div style="margin-top:8px;display:flex;gap:8px">
      <button class="btn" id="btn-clear">Limpar Carrinho</button>
      <button class="btn" id="btn-toggle-form">Finalizar Pedido</button>
    </div>  
  </section>

  <section class="panel" id="panel-form" style="display:none">
    <h3>Entrega, Frete Gr√°tis Para Guaraciaba CEP: 62380-000</h3>
    <input placeholder="Nome completo" id="inp-name" class="input" />
    <input placeholder="CEP (somente n√∫meros)" id="inp-cep" class="input" />
    <input placeholder="Rua" id="inp-street" class="input" />
    <input placeholder="N√∫mero" id="inp-number" class="input" />
    <input placeholder="Bairro" id="inp-neigh" class="input" />
    <input placeholder="Cidade" id="inp-city" class="input" />
    <input placeholder="Telefone/WhatsApp" id="inp-tel" class="input" />
    <h4>Tem cupom?</h4>
    <div style="display:flex;gap:8px;margin-bottom:8px">
      <input id="inp-coupon" class="input" placeholder="Insira o cupom" />
      <button id="btn-apply" class="btn">Aplicar</button>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <small class="muted">Taxa de entrega:</small>
      <strong id="shipping">R$ 0,00</strong>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <small class="muted">Desconto:</small>
      <strong id="discount">R$ 0,00</strong>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <small class="muted">Total:</small>
      <strong id="total">R$ 0,00</strong>
    </div>
    <div class="info-entrega">
      <h3>üì¶ Prazo de Entrega</h3>
      <p>‚û°Ô∏è Entregas para <strong>Guaraciaba do Norte (CEP 62380000)</strong>: <strong>1 dia √∫til</strong></p>
      <p>‚û°Ô∏è Entregas para outras cidades: <strong>2 dias √∫teis</strong></p>
    </div>
    <div style="display:flex;gap:8px">
      <button id="btn-whatsapp" class="btn-primary" data-whats-trigger>Finalizar pedido</button>
    </div>
  </section>

  <footer>
    <a href="reclamacoes.html" style="display:block;padding:12px;background:#caa191;color:#fff;text-align:center;border-radius:10px;text-decoration:none;font-weight:bold;">
      üì¢ Fazer Reclama√ß√£o
    </a>
  </footer>
</main>

<div class="cart-container">
  <button id="btn-open-cart" class="cart-btn">üõí Carrinho</button>
  <span id="cart-badge" class="cart-badge">0</span>
</div>

<div id="toast" class="toast">Produto adicionado ao carrinho!</div>

<!-- PAGAMENTO PIX -->
<div id="pix-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); z-index:999; align-items:center; justify-content:center;">
  <div style="background:#fff; max-width:360px; width:90%; padding:16px; border-radius:16px; text-align:center;">
    <h2 style="color:#6b3f2f;margin-top:0">üí∏ Pague com PIX</h2>
    <p id="pix-resumo" style="font-size:14px;color:#444"></p>
    <div id="pix-qrcode" style="margin:12px auto;"></div>
    <textarea id="pix-copia" readonly style="width:100%;font-size:12px;padding:8px;border-radius:8px"></textarea>
    <button onclick="copiarPix()" class="btn-primary" style="margin-top:8px">Copiar c√≥digo PIX</button>
    <button onclick="fecharPix()" class="btn" style="margin-top:6px">Cancelar</button>
  </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
// ===================== PRODUTOS =====================
const PRODUCTS = [
  {code:'T001',name:'Trufa de Morango',desc:'Trufa de morango 40g',retail:3.50,wholesale:2.00,img:'T001.png'},
  {code:'T002',name:'Trufa de Abacaxi',desc:'Trufa de abacaxi 40g',retail:4.00,wholesale:2.00,img:'T002.png'},
  {code:'T003',name:'Trufa de Brigadeiro',desc:'Trufa de brigadeiro 40g',retail:3.00,wholesale:2.00,img:'T003.png'},
  {code:'T004',name:'Trufa de Beijinho',desc:'Trufa de beijinho 40g',retail:3.00,wholesale:2.00,img:'T004.png'},
  {code:'T005',name:'Trufa de Caf√©',desc:'Trufa de caf√© 40g',retail:4.00,wholesale:2.30,img:'T005.png'},
  {code:'T006',name:'Trufa de Castanha',desc:'Trufa de Castanha 40g',retail:4.50,wholesale:2.20,img:'T006.png'},
  {code:'T007',name:'Trufa de Napolitano',desc:'Trufa de Napolitano 44g',retail:4.00,wholesale:2.10,img:'T007.png'},
  {code:'T008',name:'Trufa de Oreo',desc:'Trufa oreo 40g',retail:4.50,wholesale:2.00,img:'T008.png'},
  {code:'T009',name:'Trufa de Pa√ßoca',desc:'Trufa pa√ßoca 40g',retail:4.00,wholesale:2.00,img:'T009.png'},
  {code:'T010',name:'Trufa de Coco Queimado',desc:'Trufa coco queimado 40g',retail:3.50,wholesale:2.10,img:'T010.png'},
  {code:'T011',name:'Trufa de Maracuj√°',desc:'Trufa maracuj√° 40g',retail:3.50,wholesale:2.00,img:'T011.png'},
  {code:'T012',name:'Trufa de Lim√£o',desc:'Trufa lim√£o 40g',retail:3.50,wholesale:2.00,img:'T012.png'},
  {code:'T013',name:'Trufa de Amendoim',desc:'Trufa Amendoim 42g',retail:4.00,wholesale:2.20,img:'T013.png'},
  {code:'T014',name:'Trufa de Doce de Leite',desc:'Trufa doce de leite 44g',retail:4.00,wholesale:2.20,img:'T014.png'},
  {code:'T015',name:'Trufa de Chantilly',desc:'Trufa de chantilly 40g',retail:4.00,wholesale:2.00,img:'T015.png'},
];

// ===================== CARRINHO =====================
let cart = [];

// ===================== RENDERIZA PRODUTOS =====================
function renderProducts(){
  const container = document.getElementById("produtos");
  container.innerHTML = "";
  PRODUCTS.forEach(p=>{
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${p.img}" alt="${p.name}">
      <h3>${p.name}</h3>
      <p class="muted">${p.desc}</p>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div>
          <div class="muted">Varejo:</div>
          <div class="price">R$ ${p.retail.toFixed(2)}</div>
        </div>
        <div>
          <div class="muted">Atacado (20+):</div>
          <div class="muted">R$ ${p.wholesale.toFixed(2)}</div>
        </div>
      </div>
      <div class="row">
        <input type="number" min="1" value="1" class="qty" id="qty-${p.code}">
        <button class="btn" onclick="addToCart('${p.code}')">Adicionar</button>
      </div>
    `;
    container.appendChild(card);
  });
}
renderProducts();

// ===================== FUN√á√ïES DO CARRINHO =====================
function addToCart(code){
  const produto = PRODUCTS.find(p=>p.code===code);
  const qty = parseInt(document.getElementById(`qty-${code}`).value) || 1;
  const existing = cart.find(c=>c.code===code);
  if(existing){ existing.qty += qty; }
  else cart.push({code:produto.code,name:produto.name,qty,retail:produto.retail,wholesale:produto.wholesale,img:produto.img});
  renderCart();
  showToast(`${produto.name} adicionado ao carrinho!`);
}

function calcItemPrice(item){
  return item.qty >= 20 ? item.wholesale*item.qty : item.retail*item.qty;
}

function renderCart(){
  const list = document.getElementById("cart-list");
  list.innerHTML = "";
  cart.forEach(item=>{
    const price = calcItemPrice(item);
    const div = document.createElement("div");
    div.className = "cart-item";
    div.innerHTML = `
      <img src="${item.img}" alt="${item.name}">
      <div style="flex:1">
        <strong>${item.name}</strong>
        <small class="muted">${item.qty} x ${item.qty>=20 ? item.wholesale.toFixed(2) : item.retail.toFixed(2)}</small>
      </div>
      <div style="text-align:right">
        <div>R$ ${price.toFixed(2)}</div>
        <div style="margin-top:6px;display:flex;gap:6px;justify-content:flex-end">
          <button class="btn" onclick="removeFromCart('${item.code}')">Remover</button>
        </div>
      </div>
    `;
    list.appendChild(div);
  });
  updateTotals();
  updateCartBadge();
}

function removeFromCart(code){
  cart = cart.filter(c=>c.code!==code);
  renderCart();
}

// ===================== ABRIR/CLOSE CARRINHO =====================
const btnOpenCart = document.getElementById("btn-open-cart");
const panelCart = document.getElementById("panel-cart");
btnOpenCart.addEventListener("click", () => {
  panelCart.scrollIntoView({ behavior: "smooth" });
  panelCart.style.transition = "box-shadow 0.3s ease";
  panelCart.style.boxShadow = "0 0 20px rgba(107,63,47,0.5)";
  setTimeout(() => { panelCart.style.boxShadow = "none"; }, 800);
});

// ===================== LIMPAR CARRINHO =====================
document.getElementById("btn-clear").addEventListener("click", ()=>{
  cart = [];
  renderCart();
});

// ===================== TOTAL =====================
function updateTotals(){
  const subtotal = cart.reduce((acc,i)=>acc+calcItemPrice(i),0);
  const shipping = parseFloat(localStorage.getItem('donapaula_shipping')||0);
  const discount = parseFloat(localStorage.getItem('donapaula_discount')||0);
  const total = subtotal + shipping - discount;
  document.getElementById("subtotal").innerText = `R$ ${subtotal.toFixed(2)}`;
  document.getElementById("shipping").innerText = `R$ ${shipping.toFixed(2)}`;
  document.getElementById("discount").innerText = `R$ ${discount.toFixed(2)}`;
  document.getElementById("total").innerText = `R$ ${total.toFixed(2)}`;
}

// ===================== CUPOM =====================
document.getElementById("btn-apply").addEventListener("click",()=>{
  const code = document.getElementById("inp-coupon").value.trim().toUpperCase();
  let discount = 0;
  if(code==="TRUFA10") discount = 10.0;
  else if(code==="TRUFA5") discount = 5.0;
  else if(code) return alert("Cupom inv√°lido");
  localStorage.setItem('donapaula_discount', discount);
  updateTotals();
  alert(`Cupom aplicado: R$ ${discount.toFixed(2)}`);
});

// ===================== TOAST =====================
let toastTimer = null;
function showToast(msg){
  const t = document.getElementById("toast");
  t.innerText = msg;
  t.style.display="block";
  if(toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>{ t.style.display="none"; toastTimer=null; },2000);
}

// ===================== BADGE =====================
function updateCartBadge(){
  const badge = document.getElementById("cart-badge");
  const totalQty = cart.reduce((acc,i)=>acc+i.qty,0);
  if(totalQty>0){ badge.textContent = totalQty; badge.style.display="block"; }
  else badge.style.display="none";
}

// ===================== PIX (SEM DESCRI√á√ÉO) =====================
function gerarPixPagamento(valor){
  const chave = "gustavopaulo2283@gmail.com";
  const nome = "DonaPaula Trufas";
  const cidade = "GUARACIABA";

  function tlv(id,value){ return id + value.length.toString().padStart(2,"0") + value; }
  let payload = tlv("00","01") +
                tlv("26", tlv("00","BR.GOV.BCB.PIX")+tlv("01",chave)) +
                tlv("52","0000") + tlv("53","986") +
                tlv("54",valor.toFixed(2)) +
                tlv("58","BR") + tlv("59",nome.substring(0,25)) +
                tlv("60",cidade.substring(0,15));

  payload += "6304" + crc16(payload + "6304");

  const modal = document.getElementById("pix-modal");
  modal.style.display = "flex";
  document.getElementById("pix-resumo").innerText = `Total a pagar: R$ ${valor.toFixed(2)}`;
  document.getElementById("pix-qrcode").innerHTML="";
  new QRCode("pix-qrcode",{text:payload,width:220,height:220});
  document.getElementById("pix-copia").value=payload;
}

function copiarPix(){
  const t=document.getElementById("pix-copia");
  t.select();
  document.execCommand("copy");
  alert("PIX copiado!");
}

function fecharPix(){ document.getElementById("pix-modal").style.display="none"; }

function crc16(str){
  let crc=0xFFFF;
  for(let c=0;c<str.length;c++){ crc ^= str.charCodeAt(c)<<8; for(let i=0;i<8;i++) crc = crc &0x8000 ? (crc<<1)^0x1021 : crc<<1; }
  return (crc &0xFFFF).toString(16).toUpperCase().padStart(4,"0");
}

// ===================== FINALIZAR PEDIDO =====================
document.getElementById("btn-toggle-form").addEventListener("click",()=>{
  const form = document.getElementById("panel-form");
  form.style.display = "block";
  form.scrollIntoView({behavior:"smooth"});
});

document.getElementById("btn-whatsapp").addEventListener("click",function(e){
  e.preventDefault();
  if(cart.length===0) return alert("Adicione produtos ao carrinho!");

  const subtotal = cart.reduce((acc,i)=>acc+calcItemPrice(i),0);
  const shipping = parseFloat(localStorage.getItem('donapaula_shipping')||0);
  const discount = parseFloat(localStorage.getItem('donapaula_discount')||0);
  const total = subtotal + shipping - discount;

  let descricao = "Pedido de Trufas:\n";
  cart.forEach(item=>{ descricao += `- ${item.name} x ${item.qty} = R$ ${calcItemPrice(item).toFixed(2)}\n`; });
  descricao += `Subtotal: R$ ${subtotal.toFixed(2)}\nFrete: R$ ${shipping.toFixed(2)}\nDesconto: R$ ${discount.toFixed(2)}\nTotal: R$ ${total.toFixed(2)}\nForma de pagamento: PIX`;

  gerarPixPagamento(total);

  const modal = document.querySelector("#pix-modal div");
  if(!document.getElementById("btn-ja-paguei")){
    const btnJaPaguei = document.createElement("button");
    btnJaPaguei.id="btn-ja-paguei";
    btnJaPaguei.textContent="‚úÖ J√° Paguei";
    btnJaPaguei.className="btn-primary";
    btnJaPaguei.style.marginTop="12px";
    btnJaPaguei.onclick = ()=>{
      const phone="5588988123456"; // WhatsApp da loja
      const msg = encodeURIComponent(descricao);
      window.open(`https://wa.me/${phone}?text=${msg}`,"_blank");
      fecharPix();
      cart=[];
      renderCart();
    };
    modal.appendChild(btnJaPaguei);
  }
});
</script>


